### üí∞ Testes do M√≥dulo Finance

### Vari√°veis
@baseUrl = http://localhost:4000/api
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkNmMyNzI4Ny03Mzg2LTRhYWQtODBiZS0zNGU0MGU1Y2QzMTciLCJlbWFpbCI6ImRhdmljYW1wb3NAdHV0YS5pbyIsImp0aSI6IjYyZTE0ODNiLWVmNjEtNGZhMC05ZDllLTFkNmQ4NzQ5ZDg5MiIsImlhdCI6MTc2Mjg3NTgxNywiZXhwIjoxNzYyODc2NzE3fQ.b5QTVBsTn0q7_9EfUUhiZJ_MuRnBHfUJNnl6uhzbSTU
@userId = seu-user-id-aqui
@cosmeticId = a7faf63e-5e32-4796-b010-0b8f10ff22b1
@bundleId = 4497b6ad-4e5f-41f2-9261-11e85f8dda67
@purchaseId = 130bbf2a-a712-4aeb-b571-39881d449d4e
@toUserId = id-do-usuario-destinatario

### ============================================
### 1Ô∏è‚É£ COMPRAR UM COSM√âTICO
### ============================================
POST {{baseUrl}}/finance/purchases
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "cosmeticId": "{{cosmeticId}}"
}

### Resposta esperada:
# {
#   "id": "uuid-da-compra",
#   "userId": "uuid-do-usuario",
#   "cosmeticId": "uuid-do-cosmetic",
#   "transactionId": "uuid-da-transacao",
#   "isFromBundle": false,
#   "parentPurchaseId": null,
#   "status": "active",
#   "returnedAt": null,
#   "createdAt": "2025-11-10T...",
#   "updatedAt": "2025-11-10T..."
# }

### ============================================
### 2Ô∏è‚É£ COMPRAR UM BUNDLE
### ============================================
POST {{baseUrl}}/finance/purchases/bundle
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "bundleId": "{{bundleId}}"
}

### Resposta esperada:
# {
#   "mainPurchase": {
#     "id": "uuid-da-compra-principal",
#     "userId": "uuid-do-usuario",
#     "cosmeticId": "uuid-do-bundle",
#     "transactionId": "uuid-da-transacao",
#     "isFromBundle": false,
#     "parentPurchaseId": null,
#     "status": "active",
#     "returnedAt": null,
#     "createdAt": "2025-11-10T...",
#     "updatedAt": "2025-11-10T..."
#   },
#   "bundleItemsPurchases": [
#     {
#       "id": "uuid-compra-item-1",
#       "userId": "uuid-do-usuario",
#       "cosmeticId": "uuid-item-1",
#       "transactionId": "uuid-da-transacao",
#       "isFromBundle": true,
#       "parentPurchaseId": "uuid-da-compra-principal",
#       "status": "active",
#       "returnedAt": null,
#       "createdAt": "2025-11-10T...",
#       "updatedAt": "2025-11-10T..."
#     },
#     // ... mais itens do bundle
#   ],
#   "totalItems": 3
# }

### ============================================
### 3Ô∏è‚É£ LISTAR MINHAS COMPRAS (TODAS)
### ============================================
GET {{baseUrl}}/finance/purchases
Authorization: Bearer {{accessToken}}

### Resposta esperada:
# [
#   {
#     "id": "uuid-da-compra",
#     "userId": "uuid-do-usuario",
#     "cosmeticId": "uuid-do-cosmetic",
#     "transactionId": "uuid-da-transacao",
#     "isFromBundle": false,
#     "parentPurchaseId": null,
#     "status": "active",
#     "returnedAt": null,
#     "createdAt": "2025-11-10T...",
#     "updatedAt": "2025-11-10T..."
#   }
# ]

### ============================================
### 4Ô∏è‚É£ LISTAR COMPRAS ATIVAS (COM FILTROS)
### ============================================
GET {{baseUrl}}/finance/purchases?status=ACTIVE&limit=20&offset=0
Authorization: Bearer {{accessToken}}

### ============================================
### 5Ô∏è‚É£ LISTAR COMPRAS DEVOLVIDAS
### ============================================
GET {{baseUrl}}/finance/purchases?status=returned
Authorization: Bearer {{accessToken}}

### ============================================
### 6Ô∏è‚É£ DEVOLVER UM COSM√âTICO
### ============================================
POST {{baseUrl}}/finance/returns
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "purchaseId": "{{purchaseId}}",
  "reason": "N√£o gostei do item"
}

### Resposta esperada:
# {
#   "id": "uuid-da-devolucao",
#   "purchaseId": "uuid-da-compra",
#   "userId": "uuid-do-usuario",
#   "cosmeticId": "uuid-do-cosmetic",
#   "transactionId": "uuid-da-transacao-reembolso",
#   "reason": "N√£o gostei do item",
#   "isPartial": false,
#   "status": "completed",
#   "createdAt": "2025-11-10T...",
#   "updatedAt": "2025-11-10T..."
# }

### ============================================
### 7Ô∏è‚É£ DEVOLVER SEM MOTIVO (OPCIONAL)
### ============================================
POST {{baseUrl}}/finance/returns
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "purchaseId": "{{purchaseId}}"
}

### ============================================
### 8Ô∏è‚É£ TRANSFERIR CR√âDITOS PARA OUTRO USU√ÅRIO
### ============================================
POST {{baseUrl}}/finance/transfers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "toUserId": "{{toUserId}}",
  "amount": 1000,
  "description": "Pagamento por servi√ßo prestado"
}

### Resposta esperada:
# {
#   "id": "uuid-da-transferencia",
#   "fromUserId": "uuid-do-remetente",
#   "toUserId": "uuid-do-destinatario",
#   "fromTransactionId": "uuid-transacao-debito",
#   "toTransactionId": "uuid-transacao-credito",
#   "status": "completed",
#   "description": "Pagamento por servi√ßo prestado",
#   "createdAt": "2025-11-10T...",
#   "updatedAt": "2025-11-10T..."
# }

### ============================================
### 9Ô∏è‚É£ TRANSFERIR CR√âDITOS SEM DESCRI√á√ÉO
### ============================================
POST {{baseUrl}}/finance/transfers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "toUserId": "{{toUserId}}",
  "amount": 500
}

### ============================================
### üîü LISTAR TODAS AS TRANSFER√äNCIAS
### ============================================
GET {{baseUrl}}/finance/transfers
Authorization: Bearer {{accessToken}}

### ============================================
### 1Ô∏è‚É£1Ô∏è‚É£ LISTAR TRANSFER√äNCIAS ENVIADAS
### ============================================
GET {{baseUrl}}/finance/transfers?direction=sent
Authorization: Bearer {{accessToken}}

### ============================================
### 1Ô∏è‚É£2Ô∏è‚É£ LISTAR TRANSFER√äNCIAS RECEBIDAS
### ============================================
GET {{baseUrl}}/finance/transfers?direction=received
Authorization: Bearer {{accessToken}}

### ============================================
### 1Ô∏è‚É£3Ô∏è‚É£ LISTAR TRANSFER√äNCIAS COM PAGINA√á√ÉO
### ============================================
GET {{baseUrl}}/finance/transfers?limit=10&offset=0
Authorization: Bearer {{accessToken}}

### ============================================
### 1Ô∏è‚É£4Ô∏è‚É£ LISTAR TRANSFER√äNCIAS COMPLETADAS
### ============================================
GET {{baseUrl}}/finance/transfers?status=completed&direction=all
Authorization: Bearer {{accessToken}}

### ============================================
### ‚ùå TESTES DE ERRO
### ============================================

### Erro: Comprar sem token
POST {{baseUrl}}/finance/purchases
Content-Type: application/json

{
  "cosmeticId": "{{cosmeticId}}",
  "price": 1500
}
# Resposta esperada: 401 Unauthorized

### ---

### Erro: Comprar cosm√©tico inexistente
POST {{baseUrl}}/finance/purchases
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "cosmeticId": "00000000-0000-0000-0000-000000000000"
}
# Resposta esperada: 404 Not Found

### ---

### Erro: Comprar cosm√©tico sem pre√ßo definido
POST {{baseUrl}}/finance/purchases
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "cosmeticId": "{{cosmeticId}}"
}
# Resposta esperada: 400 Bad Request (cosm√©tico sem pre√ßo v√°lido)
# Nota: Use um cosm√©tico que tenha currentPrice null ou 0

### ---

### Erro: Comprar sem saldo suficiente
POST {{baseUrl}}/finance/purchases
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "cosmeticId": "{{cosmeticId}}"
}
# Resposta esperada: 400 Bad Request (saldo insuficiente)
# Nota: Use um cosm√©tico com pre√ßo muito alto

### ---

### Erro: Devolver compra de outro usu√°rio
POST {{baseUrl}}/finance/returns
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "purchaseId": "compra-de-outro-usuario"
}
# Resposta esperada: 400 Bad Request

### ---

### Erro: Devolver compra j√° devolvida
POST {{baseUrl}}/finance/returns
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "purchaseId": "{{purchaseId}}"
}
# Resposta esperada: 400 Bad Request (j√° foi devolvida)

### ---

### Erro: Transferir para si mesmo
POST {{baseUrl}}/finance/transfers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "toUserId": "{{userId}}",
  "amount": 1000
}
# Resposta esperada: 400 Bad Request

### ---

### Erro: Transferir valor negativo
POST {{baseUrl}}/finance/transfers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "toUserId": "{{toUserId}}",
  "amount": -500
}
# Resposta esperada: 400 Bad Request (valida√ß√£o)

### ---

### Erro: Transferir sem saldo suficiente
POST {{baseUrl}}/finance/transfers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "toUserId": "{{toUserId}}",
  "amount": 999999999
}
# Resposta esperada: 400 Bad Request (saldo insuficiente)

### ---

### Erro: Transferir para usu√°rio inexistente
POST {{baseUrl}}/finance/transfers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "toUserId": "00000000-0000-0000-0000-000000000000",
  "amount": 100
}
# Resposta esperada: 404 Not Found

### ---

### Erro: Comprar bundle que n√£o existe
POST {{baseUrl}}/finance/purchases/bundle
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "bundleId": "00000000-0000-0000-0000-000000000000"
}
# Resposta esperada: 404 Not Found

### ---

### Erro: Comprar bundle sem saldo suficiente
POST {{baseUrl}}/finance/purchases/bundle
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "bundleId": "{{bundleId}}"
}
# Resposta esperada: 400 Bad Request (saldo insuficiente)
# Nota: Use um bundle com pre√ßo alto ou esvazie os cr√©ditos do usu√°rio

### ============================================
### üìä FLUXO COMPLETO DE TESTE
### ============================================

### PASSO 1: Fazer login e obter token
# Use o arquivo auth.http para fazer login

### PASSO 2: Listar cosm√©ticos dispon√≠veis
# Use o arquivo catalog.http para obter IDs de cosm√©ticos

### PASSO 3: Comprar um cosm√©tico
# POST /finance/purchases com cosmeticId (pre√ßo √© obtido do banco)

### PASSO 4: Verificar compras
# GET /finance/purchases

### PASSO 5: Devolver o cosm√©tico
# POST /finance/returns com purchaseId

### PASSO 6: Verificar que a compra foi marcada como devolvida
# GET /finance/purchases?status=returned

### PASSO 7: Criar segundo usu√°rio para testar transfer√™ncia
# Use o arquivo auth.http para registrar outro usu√°rio

### PASSO 8: Transferir cr√©ditos
# POST /finance/transfers com toUserId e amount

### PASSO 9: Verificar transfer√™ncias
# GET /finance/transfers

### PASSO 10: Verificar saldo atualizado no perfil
# Use o arquivo users.http para ver o perfil

### ============================================
### üí° DICAS DE USO
### ============================================

# 1. Substitua as vari√°veis no topo do arquivo:
#    - @accessToken: Token JWT obtido no login
#    - @cosmeticId: ID de um cosm√©tico dispon√≠vel
#    - @purchaseId: ID de uma compra ativa
#    - @toUserId: ID de outro usu√°rio para transfer√™ncia

# 2. Os endpoints retornam:
#    - 200/201: Sucesso
#    - 400: Erro de valida√ß√£o ou regra de neg√≥cio
#    - 401: N√£o autenticado
#    - 404: Recurso n√£o encontrado

# 3. Todas as opera√ß√µes s√£o at√¥micas e usam transa√ß√µes do Prisma

# 4. Os cr√©ditos s√£o atualizados automaticamente ap√≥s cada opera√ß√£o

# 5. Para testar o fluxo completo:
#    a) Registre/fa√ßa login (auth.http)
#    b) Liste cosm√©ticos (catalog.http)
#    c) Compre um cosm√©tico
#    d) Devolva se necess√°rio
#    e) Transfira cr√©ditos para outro usu√°rio
